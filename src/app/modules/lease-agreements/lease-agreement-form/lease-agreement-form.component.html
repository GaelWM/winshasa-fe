@if ($leaseForm(); as leaseForm) {
<form
    #leaseAgreementNgForm="ngForm"
    (ngSubmit)="onSubmitNewLeaseAgreement(leaseAgreementNgForm)"
    [formGroup]="leaseForm"
    class="w-full flex flex-col flex-auto md:min-w-160 h-full"
>
    <div class="flex flex-col h-full space-y-3">
        @if (errors().length > 0) {
        <fuse-alert [type]="'error'" class="w-full">
            <span fuseAlertTitle>Error</span>
            @for (error of errors(); track error) {
            <span> {{ error.message }}</span>
            }
        </fuse-alert>
        }

        <div class="flex flex-col items-start p-2 space-y-3">
            <div class="flex flex items-start gap-5">
                <div class="w-1/2 space-y-3">
                    <div class="flex items-start gap-3">
                        <mat-form-field class="w-full">
                            <mat-label>Landlord/Owner</mat-label>
                            <mat-select
                                formControlName="landlordId"
                                placeholder="Landlord/Owner"
                                required
                            >
                                <mat-option>Select</mat-option>
                                @for (option of $landlords(); track option) {
                                <mat-option [value]="option.id">{{
                                    option.name
                                }}</mat-option>
                                }
                            </mat-select>
                            <mat-hint>Please select a Landlord/Owner</mat-hint>
                            @if ( leaseForm.controls?.landlordId?.touched &&
                            leaseForm.controls?.landlordId?.invalid ) {
                            <mat-error>
                                <app-error-form-template
                                    [form]="leaseForm"
                                    field="landlordId"
                                    name="Landlord/Owner"
                                ></app-error-form-template>
                            </mat-error>
                            }
                        </mat-form-field>

                        <mat-form-field class="w-full">
                            <mat-label>Tenant</mat-label>
                            <mat-select
                                formControlName="tenantId"
                                placeholder="Tenant"
                                required
                            >
                                <mat-option>Select</mat-option>
                                @for (option of $tenants(); track option) {
                                <mat-option [value]="option.id">{{
                                    option.name
                                }}</mat-option>
                                }
                            </mat-select>
                            <mat-hint>Please select a Tenant</mat-hint>
                            @if ( leaseForm.controls?.tenantId?.touched &&
                            leaseForm.controls?.tenantId?.invalid ) {
                            <mat-error>
                                <app-error-form-template
                                    [form]="leaseForm"
                                    field="tenantId"
                                    name="Tenant"
                                ></app-error-form-template>
                            </mat-error>
                            }
                        </mat-form-field>
                    </div>
                    <div class="flex items-start gap-3">
                        <mat-form-field class="w-full">
                            <mat-label>Lease Type</mat-label>
                            <mat-select
                                formControlName="type"
                                placeholder="Lease Type"
                                required
                            >
                                <mat-option>Select</mat-option>
                                @for (option of $types(); track option) {
                                <mat-option [value]="option.name">{{
                                    option.name
                                }}</mat-option>
                                }
                            </mat-select>
                            <mat-hint>Please select a Lease Type</mat-hint>
                            @if ( leaseForm.controls?.type?.touched &&
                            leaseForm.controls?.type?.invalid ) {
                            <mat-error>
                                <app-error-form-template
                                    [form]="leaseForm"
                                    field="type"
                                    name="Lease Type"
                                ></app-error-form-template>
                            </mat-error>
                            }
                        </mat-form-field>
                    </div>

                    <div class="flex items-start gap-3">
                        <mat-form-field class="w-full">
                            <mat-label>Property Type</mat-label>
                            <mat-select
                                formControlName="propertyType"
                                placeholder="Property Type"
                                required
                            >
                                <mat-option>Select</mat-option>
                                @for (option of $propertyTypes(); track option)
                                {
                                <mat-option [value]="option.name">{{
                                    option.name
                                }}</mat-option>
                                }
                            </mat-select>
                            <mat-hint>Please select a Property Type</mat-hint>
                            @if ( leaseForm.controls?.propertyType?.touched &&
                            leaseForm.controls?.propertyType?.invalid ) {
                            <mat-error>
                                <app-error-form-template
                                    [form]="leaseForm"
                                    field="propertyType"
                                    name="Property Type"
                                ></app-error-form-template>
                            </mat-error>
                            }
                        </mat-form-field>

                        <mat-form-field class="w-full">
                            <mat-label>Property</mat-label>
                            <mat-select
                                formControlName="propertyId"
                                placeholder="Property"
                                required
                            >
                                <mat-option>Select</mat-option>
                                @for (option of $properties(); track option) {
                                <mat-option [value]="option.id">{{
                                    option.name
                                }}</mat-option>
                                }
                            </mat-select>
                            <mat-hint>Please select a Property</mat-hint>
                            @if ( leaseForm.controls?.propertyId?.touched &&
                            leaseForm.controls?.propertyId?.invalid ) {
                            <mat-error>
                                <app-error-form-template
                                    [form]="leaseForm"
                                    field="propertyId"
                                    name="Property"
                                ></app-error-form-template>
                            </mat-error>
                            }
                        </mat-form-field>
                    </div>

                    <div class="flex items-start gap-3">
                        <mat-form-field class="w-full">
                            <mat-label>Lease Status</mat-label>
                            <mat-select
                                formControlName="status"
                                placeholder="Lease Status"
                                required
                            >
                                <mat-option>Select</mat-option>
                                @for (option of $statuses(); track option) {
                                <mat-option [value]="option.name">{{
                                    option.name
                                }}</mat-option>
                                }
                            </mat-select>
                            <mat-hint>Please select a Lease Status</mat-hint>
                            @if ( leaseForm.controls?.status?.touched &&
                            leaseForm.controls?.status?.invalid ) {
                            <mat-error>
                                <app-error-form-template
                                    [form]="leaseForm"
                                    field="status"
                                    name="Lease Status"
                                ></app-error-form-template>
                            </mat-error>
                            }
                        </mat-form-field>

                        <mat-form-field class="w-full">
                            <mat-label>Lease Template</mat-label>
                            <mat-select
                                formControlName="templateId"
                                placeholder="Lease Template"
                            >
                                <mat-option>Select</mat-option>
                                @for (option of $templateOpts(); track option) {
                                <mat-option [value]="option.id">{{
                                    option.name
                                }}</mat-option>
                                }
                            </mat-select>
                            <mat-hint>Please select a Lease Template</mat-hint>
                            @if ( leaseForm.controls?.templateId?.touched &&
                            leaseForm.controls?.templateId?.invalid ) {
                            <mat-error>
                                <app-error-form-template
                                    [form]="leaseForm"
                                    field="templateId"
                                    name="Lease Template"
                                ></app-error-form-template>
                            </mat-error>
                            }
                        </mat-form-field>
                    </div>

                    <mat-form-field class="w-full">
                        <mat-label>Currency</mat-label>
                        <mat-select
                            formControlName="currency"
                            placeholder="Currency"
                            required
                        >
                            <mat-option>Select</mat-option>
                            @for (option of paymentCurrenciesOpts; track option)
                            {
                            <mat-option [value]="option">{{
                                option
                            }}</mat-option>
                            }
                        </mat-select>
                        <mat-hint>Please select a Currency</mat-hint>
                        @if ( leaseForm.controls?.currency?.touched &&
                        leaseForm.controls?.currency?.invalid ) {
                        <mat-error>
                            <app-error-form-template
                                [form]="leaseForm"
                                field="currency"
                                name="Currency"
                            ></app-error-form-template>
                        </mat-error>
                        }
                    </mat-form-field>

                    <div class="flex items-start gap-3">
                        <mat-form-field
                            [ngClass]="formFieldHelpers"
                            class="w-full"
                        >
                            <mat-label>Rent Amount</mat-label>
                            <input
                                type="number"
                                formControlName="rent"
                                matInput
                                placeholder="Rent Amount"
                            />
                            <mat-hint>Please type in the Rent Amount </mat-hint>
                            @if ( leaseForm.controls?.rent?.touched &&
                            leaseForm.controls?.rent?.invalid ) {
                            <mat-error>
                                <app-error-form-template
                                    [form]="leaseForm"
                                    field="rent"
                                    name="Rent Amount"
                                ></app-error-form-template>
                            </mat-error>
                            }
                        </mat-form-field>

                        <mat-form-field
                            [ngClass]="formFieldHelpers"
                            class="w-full"
                        >
                            <mat-label>Security Deposit</mat-label>
                            <input
                                type="number"
                                formControlName="securityDeposit"
                                matInput
                                placeholder="Security Deposit"
                            />
                            <mat-hint
                                >Please type in the Security Deposit
                            </mat-hint>
                            @if ( leaseForm.controls?.securityDeposit ?.touched
                            && leaseForm.controls?.securityDeposit?.invalid ) {
                            <mat-error>
                                <app-error-form-template
                                    [form]="leaseForm"
                                    field="securityDeposit"
                                    name="Security Deposit"
                                ></app-error-form-template>
                            </mat-error>
                            }
                        </mat-form-field>
                    </div>

                    <div class="flex flex-col gap-1 w-full">
                        <label id="paymentFrequency"
                            >Pick the lease payment frequency</label
                        >
                        <mat-radio-group
                            aria-label="Select an option"
                            aria-labelledby="paymentFrequency"
                            formControlName="paymentFrequency"
                            class="grid grid-cols-4 gap-1 w-full"
                        >
                            @for (option of paymentFrequencyOpts; track option)
                            {
                            <mat-radio-button
                                [value]="option"
                                [color]="'primary'"
                                class="text-xs"
                                >{{ option }}</mat-radio-button
                            >
                            }
                        </mat-radio-group>
                        @if ( leaseForm.controls?.paymentFrequency?.touched &&
                        leaseForm.controls?.paymentFrequency?.invalid ) {
                        <mat-error>
                            <app-error-form-template
                                [form]="leaseForm"
                                field="paymentFrequency"
                                name="Lease Template"
                            ></app-error-form-template>
                        </mat-error>
                        }
                    </div>
                </div>
                <div class="w-1/2 space-y-3">
                    <mat-form-field class="w-full">
                        <mat-label>Lease Date</mat-label>
                        <mat-date-range-input [rangePicker]="picker">
                            <input
                                matStartDate
                                placeholder="Start date"
                                formControlName="startDate"
                            />
                            <input
                                matEndDate
                                placeholder="End date"
                                formControlName="endDate"
                            />
                        </mat-date-range-input>
                        <mat-hint>MM/DD/YYYY – MM/DD/YYYY</mat-hint>
                        <mat-datepicker-toggle
                            matIconSuffix
                            [for]="picker"
                        ></mat-datepicker-toggle>
                        <mat-date-range-picker #picker></mat-date-range-picker>
                        @if ( leaseForm.controls.startDate.hasError(
                        'matStartDateInvalid' ) ) {
                        <mat-error>Invalid start date</mat-error>
                        } @if ( leaseForm.controls.endDate.hasError(
                        'matEndDateInvalid' ) ) {
                        <mat-error>Invalid end date</mat-error>
                        }
                    </mat-form-field>

                    <mat-form-field class="w-full">
                        <mat-label>Lease Terms</mat-label>
                        <textarea
                            matInput
                            placeholder="Lease Terms"
                            name="leaseTerm"
                            formControlName="leaseTerm"
                            [rows]="2"
                        >
                        </textarea>
                        <mat-hint>Please enter Lease Terms</mat-hint>
                    </mat-form-field>

                    <mat-form-field class="w-full">
                        <mat-label>Move In Conditions</mat-label>
                        <textarea
                            matInput
                            placeholder="Move In Conditions"
                            name="moveInCondition"
                            formControlName="moveInCondition"
                            [rows]="2"
                        >
                        </textarea>
                        <mat-hint>Please enter Move In Conditions</mat-hint>
                    </mat-form-field>

                    <mat-form-field class="w-full">
                        <mat-label>Move Out Conditions</mat-label>
                        <textarea
                            matInput
                            placeholder="Move Out Conditions"
                            name="moveOutCondition"
                            formControlName="moveOutCondition"
                            [rows]="2"
                        >
                        </textarea>
                        <mat-hint>Please enter Move Out Conditions</mat-hint>
                    </mat-form-field>
                </div>
                @if (!asModal) {
                <div class="w-3/5">
                    <app-json-form
                        [template]="$selectedTemplate()"
                        [form]="leaseForm"
                        [values]="$lease().data"
                    >
                    </app-json-form>
                </div>
                }
            </div>
        </div>
    </div>

    <!-- Footer -->
    @if (showSaveButton) {
    <div
        class="w-full flex items-center justify-end border-t p-2 pb-0 border-gray-50 dark:border-gray-700"
    >
        <button
            type="submit"
            class=""
            mat-flat-button
            [color]="'primary'"
            [disabled]="!leaseForm.valid"
        >
            Save
        </button>
    </div>
    }
</form>
}
