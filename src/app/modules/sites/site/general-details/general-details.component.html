<div
    class="flex-auto pt-4 sm:px-4 sm:pb-4 overflow-y-auto"
    cdkScrollable
    *ngIf="template()?.data as template"
>
    <fuse-alert
        [type]="'error'"
        *ngIf="errors().length > 0"
        class="w-full pb-2"
    >
        <span fuseAlertTitle>Error</span>
        <span *ngFor="let error of errors()"> {{ error.message }}</span>
    </fuse-alert>
    <form
        *ngIf="siteForm() as siteForm"
        id="ngForm"
        #siteNgForm="ngForm"
        (ngSubmit)="onSaveSite(siteNgForm)"
        [formGroup]="siteForm"
    >
        <app-json-form
            [template]="template"
            [form]="siteForm"
            [values]="site()?.data"
        >
            <ng-template jsonFormFirstCol>
                <div class="w-full my-1">
                    <mat-expansion-panel [expanded]="true" class="mr-2 h-max">
                        <mat-expansion-panel-header class="dark:bg-gray-700">
                            <mat-panel-title>
                                Mandatory Fields
                            </mat-panel-title>
                        </mat-expansion-panel-header>

                        <div class="flex flex-col gap-1 md:gap-2 mt-2">
                            <input
                                type="hidden"
                                name="templateId"
                                formControlName="templateId"
                            />
                            <mat-form-field class="w-full">
                                <mat-label>Site Name</mat-label>
                                <input
                                    matInput
                                    name="name"
                                    formControlName="name"
                                />
                                <mat-error
                                    *ngIf="
                                        siteForm.controls &&
                                        siteForm.controls['name']?.touched &&
                                        siteForm.controls['name']?.invalid
                                    "
                                    class="flex flex-col gap-2"
                                >
                                    <span
                                        *ngIf="
                                            siteForm.controls['name'] &&
                                            siteForm.controls['name'].errors &&
                                            siteForm.controls['name'].errors
                                                .required
                                        "
                                        >Site name is mandatory</span
                                    >
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field class="w-full">
                                <mat-label>Site status</mat-label>
                                <mat-select
                                    placeholder="Site status"
                                    formControlName="status"
                                    name="status"
                                >
                                    <mat-option>Select</mat-option>
                                    <ng-container *ngIf="statusOptions()">
                                        <mat-option
                                            *ngFor="
                                                let option of statusOptions()
                                            "
                                            [value]="option.name"
                                            >{{ option.name }}</mat-option
                                        >
                                    </ng-container>
                                </mat-select>
                                <mat-error
                                    *ngIf="
                                        siteForm.controls &&
                                        siteForm.controls['status']?.touched &&
                                        siteForm.controls['status']?.invalid
                                    "
                                    class="flex flex-col gap-2"
                                >
                                    <span
                                        *ngIf="
                                            siteForm.controls['status'] &&
                                            siteForm.controls['status']
                                                .errors &&
                                            siteForm.controls['status'].errors
                                                .required
                                        "
                                        >Site status is mandatory</span
                                    >
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field class="w-full">
                                <mat-label>Site Type</mat-label>
                                <mat-select
                                    placeholder="Site status"
                                    name="type"
                                    formControlName="type"
                                >
                                    <mat-option>Select</mat-option>
                                    <ng-container *ngIf="typeOptions()">
                                        <mat-option
                                            *ngFor="let option of typeOptions()"
                                            [value]="option.name"
                                            >{{ option.name }}</mat-option
                                        >
                                    </ng-container>
                                </mat-select>
                                <mat-error
                                    *ngIf="
                                        siteForm.controls &&
                                        siteForm.controls['type']?.touched &&
                                        siteForm.controls['type']?.invalid
                                    "
                                    class="flex flex-col gap-2"
                                >
                                    <span
                                        *ngIf="
                                            siteForm.controls['type'] &&
                                            siteForm.controls['type'].errors &&
                                            siteForm.controls['type'].errors
                                                .required
                                        "
                                        >Site type is mandatory</span
                                    >
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field class="w-full">
                                <mat-label>Latitude</mat-label>
                                <input
                                    matInput
                                    name="latitude"
                                    formControlName="latitude"
                                />
                            </mat-form-field>
                            <mat-form-field class="w-full">
                                <mat-label>Longitude</mat-label>
                                <input
                                    matInput
                                    name="longitude"
                                    formControlName="longitude"
                                />
                            </mat-form-field>
                        </div>
                    </mat-expansion-panel>
                </div>
            </ng-template>
        </app-json-form>
    </form>
</div>
