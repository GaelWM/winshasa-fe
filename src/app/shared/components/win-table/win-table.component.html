<div class="table__container">
    <caption *ngIf="caption !== ''">
        {{
            caption
        }}
    </caption>
    <table>
        <thead>
            <tr>
                <th *ngFor="let column of columns">
                    <button
                        class="w-full flex justify-between items-center gap-2"
                        (click)="
                            column.clickEvent && allowSort && onSort(column)
                        "
                    >
                        <span>{{ column.title }}</span>
                        <a
                            mat-icon-button
                            type="button"
                            color="secondary"
                            *ngIf="column.clickEvent && allowSort"
                        >
                            <mat-icon
                                *ngIf="column.sortOrder === 'asc'"
                                class="text-md"
                                >arrow_upward</mat-icon
                            >
                            <mat-icon
                                *ngIf="column.sortOrder === 'desc'"
                                class="text-md"
                                >arrow_downward</mat-icon
                            >
                        </a>
                    </button>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr
                *ngFor="let row of data"
                class="hover:bg-gray-800 text-primary font-bold py-2 px-4 rounded transition duration-300"
                [ngClass]="{ 'cursor-pointer': allowRowClick }"
                (click)="allowRowClick && onRowClick(row)"
            >
                <ng-container *ngFor="let column of columns">
                    <ng-container
                        *ngTemplateOutlet="
                            column.template ? column.template : tableRow;
                            context: { row: row, column: column }
                        "
                    ></ng-container>
                </ng-container>
            </tr>
        </tbody>
    </table>
</div>

<ng-template let-row="row" let-column="column" #tableRow>
    <td
        [style]="column.style ?? ''"
        [class]="column.customClass ?? ''"
        [ngClass]="{ 'cursor-pointer': column.clickEvent }"
        (click)="allowCellClick && onCellClick(row, column)"
    >
        <ng-container
            *ngIf="column.pipe"
            [winDynamicDirective]="column.directive"
        >
            <div *ngIf="!column.safeHtml">
                {{
                    row
                        | winNestedValue : column.key
                        | winDynamicPipe : column.pipe.class : column.pipe.args
                }}
            </div>
            <div
                *ngIf="column.safeHtml"
                [innerHTML]="
                    row
                        | winNestedValue : column.key
                        | winDynamicPipe : column.pipe.class : column.pipe.args
                        | winSafeHtml
                "
            ></div>
        </ng-container>
        <ng-container
            *ngIf="!column.pipe"
            [winDynamicDirective]="column.directive"
        >
            <div *ngIf="!column.safeHtml">
                {{ row | winNestedValue : column.key }}
            </div>
            <div
                *ngIf="column.safeHtml"
                [innerHtml]="row | winNestedValue : column.key | winSafeHtml"
            ></div>
        </ng-container>
    </td>
</ng-template>
